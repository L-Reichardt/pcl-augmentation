# Launching Real3D-Aug for 3D object detection dataset

## 1. Adjusting config file

- Adjust paths
   - *dataset_path* - path to dataset files
   - *maps_path* - path to directory, where created map will be stored
   - *label_path* - path to directory, where semantic labels are stored
   - *sample_path* - path to directory, where cutted objects will be stored
   - *output_path* - path to directory, where outputs of the algorithm will be stored
   - *train_txt_path*[^*] - path to txt file, which contains names of frame in training part of dataset
- Insertion paramethers
   - *classes* - set of classes names, which would augment frames (all these classes need to have filled: min_points, placement, labels_shortcut and labels)
   - *min_points* - minimal number of object points, which need to be visible to add object to frame
   - *random* - bool variable, if it is **True** method adds to frames as many objects as value of *number_of_object* is, however number of samples of each class will be randomly generated. If it is **False** algorithm uses *number_of_classes* as number of samples of each class, which adds to frames
   - *number_of_object* - number of objects, which are placed in frame (relevant only if *random* is **True**)
   - *number_of_classes* - list with same shape as *classes*. Values in list represent number of samples, which will be places in frame, of corresponding class in *classes*
   - *placement* - name of semantic label, where object can be located, e.i. "Road" for cyclist and "Sidewalk" for pedestrians.
   - *labels_shortcut* - shortcut of classes name (1-3 letters recommended)
   - *labels* - indexes of semantic labels

[^*]: for KITTI dataset

## 2. Data preprocessing
- **Rich maps**  
Rich maps are generated by running python script [single_drivable_area_map.py](rich_map/single_drivable_area_map.py). Script has boolen *DEBUG* variable. If this variable is set to **True**, script along side maps in .npz format (used further) create .png pictures of maps. KITTI dataset is not captured in sequences and morphologic operations are applied to them, therefore two binary maps are generated for each frame (one for drivable area and other for pedestrian area).
- **Object database**  
Object database is created by running python script [object_cut_out.py](cut_object/object_cut_out.py). Script cut out only classes, which will be used for augmentation (based on config file). Only fully visible objects are stored.
- **Pseudo-labeling**  
For pseudo-labeling we choose Cylinder3D, which was second on segmentation task on SemnaticKITTI, when we developed this project. Here is [link](https://arxiv.org/pdf/2011.10033.pdf) to official paper and [github repo](https://github.com/xinge008/Cylinder3D) which was copied to this folder. 
Codes were adjusted for our purpose. To create prediction of semantic KITTI (pseudo labels, which we used for insertion of cars) you need to run [main.py](pseudo_labels/create_labels/main.py) in dir ```pseudo_labels/create_labels/main.py``` with args ```--demo-folder "str:path to velodyne data" --save-folder "str:path to file, where you want save predictions" --cuda "int:number of cude, which you want to connect to```

## 3. Data augmentation
Augmentation is launched by running python script [insertion.py](Real3D-Aug/insertion.py). At fitst you need to choose, which dataset you want to augment. 
If this is first run of script on chosen dataset, algorithm start right away. If not on terminal will show: *Default save folder is already existing do you want change name? [yes/no]*. If you choose *yes*, you can change save folder (only values 0-99 is valid) in order to achieve e.i. 5:1 augmented to original frames.
Algorithm can run on multiple cores at ones without overleaping computations, therefore feel free to run algorithm multiple times on same save folder in order to decrease time, which is needed to augment whole dataset.

## Own dataset
If you want to launch algorithm on your own dataset, you need to create config file and dataset class in datasets.py acording to [KITTI.yaml](config/KITTI.yaml) and [datasets.py](Real3D-Aug/tools/datasets.py).
